{% extends 'base.html' %}
{% load humanize %}
{% block content %}
<script>
    var selectedProductSet = new Set();

    function addProductToTable() {
        var selectedProducts = document.getElementById('selectedProducts');
        var quantities = document.getElementById('quantities');
        var productTable = document.getElementById('productTable');

        var selectedProductId = selectedProducts.value;
        var quantity = quantities.value;

        // Check if product is already added
        if (!selectedProductSet.has(selectedProductId)) {
            selectedProductSet.add(selectedProductId);

            var row = productTable.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2); // Added for standard price

            cell1.innerText = selectedProducts.options[selectedProducts.selectedIndex].text;
            cell2.innerText = quantity;

            // Fetch standard price from selected product
            var product = document.getElementById('selectedProducts').options[document.getElementById('selectedProducts').selectedIndex];
            var standardPrice = product.getAttribute('data-standard-price');
            cell3.innerText = standardPrice;

            // Create hidden inputs to send product and quantity data with the form
            var input1 = document.createElement("input");
            input1.type = "hidden";
            input1.name = "selected_products";
            input1.value = selectedProductId;
            row.appendChild(input1);

            var input2 = document.createElement("input");
            input2.type = "hidden";
            input2.name = "quantities";
            input2.value = quantity;
            row.appendChild(input2);
        } else {
            // Handle duplicate product selection (e.g., show a message)
            alert("Product already added to the table.");
        }
    }

    function clearSelectedProductSet() {
        selectedProductSet.clear();
    }
</script>



<h2>Sell Products</h2>

<form method="post" action="{% url 'sell_products' %}" onsubmit="clearSelectedProductSet()">
    {% csrf_token %}

    <label for="products">Select Products:</label>
    <select id="selectedProducts" name="selected_products">
        {% for product in products %}
        <option value="{{ product.id }}" data-standard-price="{{ product.standard_price|intcomma }}">{{ product.name }}</option>
        {% endfor %}
    </select>

    <label for="quantity">Quantity:</label>
    <input type="number" id="quantities" name="quantities" value="1" min="1">

    <button type="button" onclick="addProductToTable()">Add to Table</button>
<hr>
    <table id="productTable" class="table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Standard Price</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>

    <button type="submit">Sell Products</button>
</form>
{% endblock content %}
