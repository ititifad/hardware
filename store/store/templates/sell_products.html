{% extends 'base.html' %}

{% block content %}
<style>
  thead {
    background-color: rgb(202, 202, 202);
    color: rgb(97, 97, 97);
  }
</style>

<div class="container">

  <p style="color: red;">
  {{error_message}}
  </p>

  <div class="row">

    <form method="POST" action="{% url 'sell_products' %}">
      {% csrf_token %}
      <!-- <label for="formGroupExampleInput" class="form-label">Barcode:</label> -->
      <div class="col-lg-4">
      <div class="input-group mb-3">
      <input type="text" id="barcode" name="barcode" placeholder="Enter/Scan Product Code" class="form-control" required>
      <button class="btn btn-outline-secondary" type="submit" id="button-addon2">Search Product</button>
      </div>
      </div>
      <!-- <button type="submit">Search</button> -->
    </form>

    <div class="col-lg-12 pt-3">
    <div class="table-responsive">
      <table class="table">
        <thead>
          <tr>
          <th>No.</th>
          <th>Product Code</th>
          <th>Description</th>
          <th>In Stock</th>
          <th>Price</th>
          <th>Quantity</th>
         
          </tr>
        </thead>
        <tbody>
          {% if product %}
          <tr>
          <th>{{ product.id }}</th>
          <td>{{product.barcode}}</td>
          <td>{{product.name}}</td>
          <td>{{product.inventory_quantity}}</td>
          <td>{{product.standard_price}}</td>
          <td><form method="POST" action="{% url 'sell_products' %}">
            {% csrf_token %}
            <input type="hidden" name="barcode" value="{{ product.barcode }}">
            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" min="1" max="{{ product.inventory_quantity }}" required>
            <button type="submit" class="btn btn-secondary btn-sm">Click To Sell</button>
          </form></td>
          
          </tr>
        {% endif %}
        </tbody>
      </table>
    </div>
    </div>
    
    

    
</div>
</div>


<script>
  $(document).ready(function() {
      $('#sell-form').submit(function(event) {
          event.preventDefault();  // Prevent the form from submitting normally

          var formData = $(this).serialize();

          $.ajax({
              type: "POST",
              url: "{% url 'sell_products' %}",
              data: formData,
              success: function(response) {
                  // Update the total cost element with the returned value
                  $('#total-cost').text(response.total_cost);
              },
              error: function(xhr, status, error) {
                  console.error(error);
              }
          });
      });
  });
</script>

{% endblock %}